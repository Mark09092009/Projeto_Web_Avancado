{% extends "base.html" %} 
{% load widget_tweaks %} 

{% block title %}{{ titulo }}{% endblock %} 

{% block content %}
<div class="container mt-5">
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4">
        <h2 class="mb-3 mb-md-0 text-primary">{{ titulo }}</h2>
        
        <div class="d-flex gap-2 w-100 w-md-auto">
            <a href="{% url 'edit_combustiveis' %}" class="btn btn-warning w-50 w-md-auto">
                <i class="fas fa-tag"></i> <span class="d-none d-md-inline">Editar Preços/Serviços</span>
                <span class="d-inline d-md-none">Editar Preços</span> 
            </a>
            <a href="{% url 'adicionar_combustivel' %}" class="btn btn-success w-50 w-md-auto">
                <i class="fas fa-plus-circle"></i> <span class="d-none d-md-inline">Adicionar Novo Combustível</span>
                <span class="d-inline d-md-none">Adicionar</span>
            </a>
        </div>
    </div>
    
    <div class="card shadow-lg mb-5 border-success">
        <div class="card-header bg-success text-white">
            <h5 class="mb-0">Registrar Entrada / Saída</h5>
        </div>
        <div class="card-body">
            <form method="POST" action="{% url 'estoque_gasolina' %}">
                {% csrf_token %}
                <div class="row g-3">
                    <div class="col-12 col-md-4">
                        <label for="{{ form.combustivel.id_for_label }}" class="form-label">
                            {{ form.combustivel.label }}
                        </label>
                        {% render_field form.combustivel class="form-select" %}
                        {% for error in form.combustivel.errors %}
                            <div class="text-danger small">{{ error }}</div>
                        {% endfor %}
                    </div>

                    <div class="col-12 col-md-4">
                        <label for="{{ form.quantidade.id_for_label }}" class="form-label">
                            {{ form.quantidade.label }}
                        </label>
                        {% render_field form.quantidade class="form-control" type="number" step="0.01" min="0" %}
                        {% for error in form.quantidade.errors %}
                            <div class="text-danger small">{{ error }}</div>
                        {% endfor %}
                    </div>

                    <div class="col-12 col-md-3">
                        <label for="{{ form.movimento.id_for_label }}" class="form-label">
                            {{ form.movimento.label }}
                        </label>
                        {% render_field form.movimento class="form-select" %}
                        {% for error in form.movimento.errors %}
                            <div class="text-danger small">{{ error }}</div>
                        {% endfor %}
                    </div>

                    <div class="col-12 col-md-1 d-flex align-items-end">
                        <button type="submit" class="btn btn-primary w-100">
                            Registrar
                        </button>
                    </div>
                </div>
                {% if form.non_field_errors %}
                <div class="alert alert-danger mt-3">
                    {% for error in form.non_field_errors %}
                    <strong>Erro:</strong> {{ error }}<br />
                    {% endfor %}
                </div>
                {% endif %}
            </form>
        </div>
    </div>
    
    <h3 class="mb-3">Estoque Atual</h3>
    <div class="card shadow-sm">
        <div class="card-body">
            {% if messages %} 
            {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">{{ message }}</div>
            {% endfor %} 
            {% endif %}

            {% if estoques %}
            <div class="table-responsive">
                <table class="table table-hover table-striped">
                    <thead class="bg-light">
                        <tr>
                            <th scope="col">Combustível</th>
                            <th scope="col">Quantidade (L)</th>
                            <th scope="col" class="text-nowrap">Preço (R$)</th>
                            <th scope="col" class="text-nowrap">Última Atualização</th>
                            <th scope="col">Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in estoques %}
                        <tr>
                            <td>{{ item.get_tipo_display }}</td>
                            <td>
                                <strong>{{ item.quantidade_litros|floatformat:2 }} L</strong>
                            </td>
                            <td>
                                <strong class="text-success">R$ {{ item.preco_atual_litro|floatformat:2 }}</strong>
                            </td>
                            <td>{{ item.data_ultima_atualizacao|date:"d/m/Y H:i" }}</td>
                            <td>
                                {% if item.quantidade_litros <= 100 %}
                                <span class="badge text-bg-danger">BAIXO</span>
                                {% elif item.quantidade_litros <= 500 %}
                                <span class="badge text-bg-warning">MODERADO</span>
                                {% else %}
                                <span class="badge text-bg-success">NORMAL</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="alert alert-info" role="alert">
                Nenhum item de estoque encontrado. <a href="{% url 'adicionar_combustivel' %}" class="alert-link">Clique aqui para adicionar o primeiro.</a>
            </div>
            {% endif %}
        </div>
    </div>

    <div class="mt-3">
        <p class="text-muted">Acesso restrito para gerenciamento de estoque.</p>
    </div>
</div>
{% endblock %}